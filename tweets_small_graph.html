<!DOCTYPE html>
<meta charset="utf-8">
<script src="https://platform.twitter.com/widgets.js"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<style>

.links line {
  stroke: #999;
  stroke-opacity: 0.8;
  stroke-width: 2px;
}

line.reply {
  stroke: #999;
}

line.retweet {
  stroke-dasharray: 5;
}

line.quote {
  stroke-dasharray: 5;
}

.nodes circle {
  stroke: red;
  fill: red;
  stroke-width: 1.5px;
}

circle.retweet {
  fill: white;
  stroke: #999;
}

circle.reply {
  fill: #999;
  stroke: #999;
}

circle.quote {
  fill: yellow;
  stroke: yellow;
}

#graph {
  width: 99vw;
  height: 99vh;
}

#tweet {
  position: absolute;
  left: 100px;
  top: 150px;
}

</style>
<svg id="graph"></svg>
<div id="tweet"></div>
<script>

var width = $(window).width();
var height = $(window).height();

var svg = d3.select("svg")
    .attr("height", height)
    .attr("width", width);

var color = d3.scaleOrdinal(d3.schemeCategory20c);

var simulation = d3.forceSimulation()
    .velocityDecay(0.6)
    .force("link", d3.forceLink().id(function(d) { return d.id; }))
    .force("charge", d3.forceManyBody())
    .force("center", d3.forceCenter(width / 2, height / 2));

var graph = {
  "nodes": [
    {
      "id": "968142475352313857",
      "type": "reply",
      "screen_name": "OurPresidents"
    },
    {
      "id": "968140941155557376",
      "type": null,
      "screen_name": "OurPresidents"
    },
    {
      "id": "968187745523953670",
      "type": "quote",
      "screen_name": "carable8"
    },
    {
      "id": "968186916943384576",
      "type": null,
      "screen_name": "StLouisArchives"
    },
    {
      "id": "968225341490778112",
      "type": "quote",
      "screen_name": "librariesval"
    },
    {
      "id": "968216823333314566",
      "type": null,
      "screen_name": "HelpingKidsRise"
    },
    {
      "id": "968260568669872128",
      "type": "quote",
      "screen_name": "BergisJules"
    },
    {
      "id": "968221746120753154",
      "type": null,
      "screen_name": "NMAAHC"
    },
    {
      "id": "968489471497986048",
      "type": "quote",
      "screen_name": "UMD_MITH"
    },
    {
      "id": "968492633319460864",
      "type": "quote",
      "screen_name": "_BlackMuses"
    },
    {
      "id": "968486743816245248",
      "type": null,
      "screen_name": "NMAAHC"
    },
    {
      "id": "968496565315710978",
      "type": "quote",
      "screen_name": "BergisJules"
    },
    {
      "id": "968495353975762945",
      "type": null,
      "screen_name": "NMAAHC"
    },
    {
      "id": "968496766172753921",
      "type": "reply",
      "screen_name": "NMAAHC"
    },
    {
      "id": "968497633013547008",
      "type": "reply",
      "screen_name": "documentnow"
    },
    {
      "id": "968498411208085504",
      "type": "reply",
      "screen_name": "NMAAHC"
    },
    {
      "id": "968498788104065024",
      "type": "quote",
      "screen_name": "seth_denbo"
    },
    {
      "id": "968498909248045057",
      "type": "reply",
      "screen_name": "documentnow"
    },
    {
      "id": "968499050348609538",
      "type": "reply",
      "screen_name": "documentnow"
    },
    {
      "id": "968499775187439617",
      "type": "quote",
      "screen_name": "fromADMwithlove"
    },
    {
      "id": "968500750983876608",
      "type": "reply",
      "screen_name": "NMAAHC"
    },
    {
      "id": "968501316040429568",
      "type": "reply",
      "screen_name": "NMAAHC"
    },
    {
      "id": "968501436303728640",
      "type": "quote",
      "screen_name": "USNatArchives"
    },
    {
      "id": "968501647847469056",
      "type": "reply",
      "screen_name": "documentnow"
    },
    {
      "id": "968501831914549250",
      "type": "reply",
      "screen_name": "documentnow"
    },
    {
      "id": "968502246571995137",
      "type": "reply",
      "screen_name": "USNatArchives"
    },
    {
      "id": "968503056856944640",
      "type": "reply",
      "screen_name": "fromADMwithlove"
    },
    {
      "id": "968503063404302336",
      "type": "reply",
      "screen_name": "NMAAHC"
    },
    {
      "id": "968503295617720320",
      "type": "reply",
      "screen_name": "edsu"
    },
    {
      "id": "968503914332086272",
      "type": "reply",
      "screen_name": "NMAAHC"
    },
    {
      "id": "968504094661980161",
      "type": "reply",
      "screen_name": "fromADMwithlove"
    },
    {
      "id": "968504591930220546",
      "type": "reply",
      "screen_name": "documentnow"
    },
    {
      "id": "968506316334489602",
      "type": "reply",
      "screen_name": "edsu"
    },
    {
      "id": "968506401998954496",
      "type": "reply",
      "screen_name": "NMAAHC"
    },
    {
      "id": "968507233695809537",
      "type": "reply",
      "screen_name": "documentnow"
    },
    {
      "id": "968507390092967936",
      "type": "reply",
      "screen_name": "documentnow"
    },
    {
      "id": "968507437731983366",
      "type": "quote",
      "screen_name": "timothyanne"
    },
    {
      "id": "968507568040660992",
      "type": "reply",
      "screen_name": "edsu"
    },
    {
      "id": "968507612185559040",
      "type": "reply",
      "screen_name": "documentnow"
    },
    {
      "id": "968507925428932608",
      "type": "reply",
      "screen_name": "fromADMwithlove"
    },
    {
      "id": "968508241339547649",
      "type": "quote",
      "screen_name": "BergisJules"
    },
    {
      "id": "968509177772482560",
      "type": "reply",
      "screen_name": "documentnow"
    },
    {
      "id": "968509306273521664",
      "type": "reply",
      "screen_name": "NMAAHC"
    },
    {
      "id": "968511211196370944",
      "type": "reply",
      "screen_name": "edsu"
    },
    {
      "id": "968511307677827072",
      "type": "reply",
      "screen_name": "NMAAHC"
    },
    {
      "id": "968511478977482753",
      "type": "reply",
      "screen_name": "USNatArchives"
    },
    {
      "id": "968511656597766144",
      "type": "quote",
      "screen_name": "BergisJules"
    },
    {
      "id": "968512144739328000",
      "type": "reply",
      "screen_name": "edsu"
    },
    {
      "id": "968512489607565312",
      "type": "quote",
      "screen_name": "amaliasl"
    },
    {
      "id": "968512491113283584",
      "type": "reply",
      "screen_name": "amaliasl"
    },
    {
      "id": "968512812665397249",
      "type": "reply",
      "screen_name": "documentnow"
    },
    {
      "id": "968518623932203008",
      "type": "quote",
      "screen_name": "BergisJules"
    },
    {
      "id": "968522016943898624",
      "type": "quote",
      "screen_name": "afroxmericana"
    }
  ],
  "links": [
    {
      "source": "968142475352313857",
      "target": "968140941155557376",
      "type": "reply"
    },
    {
      "source": "968187745523953670",
      "target": "968186916943384576",
      "type": "quote"
    },
    {
      "source": "968225341490778112",
      "target": "968216823333314566",
      "type": "quote"
    },
    {
      "source": "968260568669872128",
      "target": "968221746120753154",
      "type": "quote"
    },
    {
      "source": "968489471497986048",
      "target": "968221746120753154",
      "type": "quote"
    },
    {
      "source": "968492633319460864",
      "target": "968486743816245248",
      "type": "quote"
    },
    {
      "source": "968496565315710978",
      "target": "968495353975762945",
      "type": "quote"
    },
    {
      "source": "968496766172753921",
      "target": "968495353975762945",
      "type": "reply"
    },
    {
      "source": "968497633013547008",
      "target": "968496766172753921",
      "type": "reply"
    },
    {
      "source": "968498411208085504",
      "target": "968496766172753921",
      "type": "reply"
    },
    {
      "source": "968498788104065024",
      "target": "968497633013547008",
      "type": "quote"
    },
    {
      "source": "968498909248045057",
      "target": "968498411208085504",
      "type": "reply"
    },
    {
      "source": "968499050348609538",
      "target": "968498909248045057",
      "type": "reply"
    },
    {
      "source": "968499775187439617",
      "target": "968499050348609538",
      "type": "quote"
    },
    {
      "source": "968500750983876608",
      "target": "968498411208085504",
      "type": "reply"
    },
    {
      "source": "968501316040429568",
      "target": "968498411208085504",
      "type": "reply"
    },
    {
      "source": "968501436303728640",
      "target": "968495353975762945",
      "type": "quote"
    },
    {
      "source": "968501647847469056",
      "target": "968501316040429568",
      "type": "reply"
    },
    {
      "source": "968501831914549250",
      "target": "968501647847469056",
      "type": "reply"
    },
    {
      "source": "968502246571995137",
      "target": "968501647847469056",
      "type": "reply"
    },
    {
      "source": "968503056856944640",
      "target": "968501316040429568",
      "type": "reply"
    },
    {
      "source": "968503063404302336",
      "target": "968502246571995137",
      "type": "reply"
    },
    {
      "source": "968503295617720320",
      "target": "968500750983876608",
      "type": "reply"
    },
    {
      "source": "968503914332086272",
      "target": "968501316040429568",
      "type": "reply"
    },
    {
      "source": "968504094661980161",
      "target": "968502246571995137",
      "type": "reply"
    },
    {
      "source": "968504591930220546",
      "target": "968503914332086272",
      "type": "reply"
    },
    {
      "source": "968506316334489602",
      "target": "968503914332086272",
      "type": "reply"
    },
    {
      "source": "968506401998954496",
      "target": "968503914332086272",
      "type": "reply"
    },
    {
      "source": "968507233695809537",
      "target": "968506401998954496",
      "type": "reply"
    },
    {
      "source": "968507390092967936",
      "target": "968506401998954496",
      "type": "reply"
    },
    {
      "source": "968507437731983366",
      "target": "968486743816245248",
      "type": "quote"
    },
    {
      "source": "968507568040660992",
      "target": "968506401998954496",
      "type": "reply"
    },
    {
      "source": "968507612185559040",
      "target": "968506401998954496",
      "type": "reply"
    },
    {
      "source": "968507925428932608",
      "target": "968507233695809537",
      "type": "reply"
    },
    {
      "source": "968508241339547649",
      "target": "968506401998954496",
      "type": "quote"
    },
    {
      "source": "968509177772482560",
      "target": "968506401998954496",
      "type": "reply"
    },
    {
      "source": "968509306273521664",
      "target": "968506401998954496",
      "type": "reply"
    },
    {
      "source": "968511211196370944",
      "target": "968507612185559040",
      "type": "reply"
    },
    {
      "source": "968511307677827072",
      "target": "968506401998954496",
      "type": "reply"
    },
    {
      "source": "968511478977482753",
      "target": "968503063404302336",
      "type": "reply"
    },
    {
      "source": "968511656597766144",
      "target": "968511211196370944",
      "type": "quote"
    },
    {
      "source": "968512144739328000",
      "target": "968509177772482560",
      "type": "reply"
    },
    {
      "source": "968512489607565312",
      "target": "968501316040429568",
      "type": "quote"
    },
    {
      "source": "968512491113283584",
      "target": "968512489607565312",
      "type": "reply"
    },
    {
      "source": "968512812665397249",
      "target": "968512144739328000",
      "type": "reply"
    },
    {
      "source": "968518623932203008",
      "target": "968495353975762945",
      "type": "quote"
    },
    {
      "source": "968522016943898624",
      "target": "968511307677827072",
      "type": "quote"
    }
  ]
};

var link = svg.append("g")
    .attr("class", "links")
  .selectAll("line")
  .data(graph.links)
  .enter().append("line")
    .attr("class", function(d) { return d.type; });

var node = svg.append("g")
    .attr("class", "nodes")
  .selectAll("circle")
  .data(graph.nodes)
  .enter().append("circle")
    .attr("r", 5)
    .attr("class", function(d) { return d.type; })
    .call(d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended));

node.append("title")
    .text(function(d) { return d.id; });

node.on("click", function(d) {
  $("#tweet").empty();

  var rect = this.getBoundingClientRect();
  var paneHeight = d.type == "retweet" ? 50 : 200;
  var paneWidth = d.type == "retweet" ? 75 : 500;

  var left = rect.x - paneWidth / 2;
  if (rect.y > height / 2) {
    var top = rect.y - paneHeight;
  } else {
    var top = rect.y + 10;
  }

  var tweet = $("#tweet");
  tweet.css({left: left, top: top});

  if (d.type == "retweet") {
    twttr.widgets.createFollowButton(d.screen_name, tweet[0], {size: "large"});
  } else {
    twttr.widgets.createTweet(d.id, tweet[0], {conversation: "none"});
  }

  d3.event.stopPropagation();

});

svg.on("click", function(d) {
  $("#tweet").empty();
});

simulation
    .nodes(graph.nodes)
    .on("tick", ticked);

simulation.force("link")
    .links(graph.links);

function ticked() {
  link
      .attr("x1", function(d) { return d.source.x; })
      .attr("y1", function(d) { return d.source.y; })
      .attr("x2", function(d) { return d.target.x; })
      .attr("y2", function(d) { return d.target.y; });

  node
      .attr("cx", function(d) { return d.x; })
      .attr("cy", function(d) { return d.y; });
}

function dragstarted(d) {
  if (!d3.event.active) simulation.alphaTarget(0.3).restart();
  d.fx = d.x;
  d.fy = d.y;
}

function dragged(d) {
  d.fx = d3.event.x;
  d.fy = d3.event.y;
}

function dragended(d) {
  if (!d3.event.active) simulation.alphaTarget(0);
  d.fx = null;
  d.fy = null;
}

</script>
